# Документация по работе с сокетами

## Подключение

Для подключения к сокету рекомендуется использовать библиотеку [phoenix](https://www.npmjs.com/package/phoenix). Пример использования библиотеки можно найти в файле [user_socket.js](assets/js/user_socket.js).

### URL для подключения

Подключение к сокету осуществляется по пути `/api/socket`.

### Аутентификация

При подключении необходимо указать текущий API токен.

### Формирование топика

Название топика формируется следующим образом:

```plaintext
chat:${cv_id}:${vacancy_id}
```

## Подготовка к подключению

Перед подключением к сокету необходимо создать чат с помощью API-запроса:

```plaintext
POST /api/chats/send_message
```

Без предварительного создания чата подключение будет неудачным.

## Ивенты

### Инициализация

Сразу после подключения по сокету придут уже отправленные в этом чате сообщения. Данные будут в виде массива сообщений.

### Отправка сообщения

Сервер принимает ивенты только одного типа: `new_message` с параметрами сообщения в теле.

### Получение нового сообщения

При создании нового сообщения сервер отправляет ивент `new_message` клиенту с сообщением в теле.

### Схема сообщений

Схема сообщения аналогична соответствующей схеме `Message` для запроса

```plaintext
POST /api/chats/send_message
```

## Попробовать

Скрипт из примера можно проверить по адресу:

```plaintext
/chat_dev?cv_id=123&vacancy_id=456&token=ваш_токен
```

Скрипт подключится к чату и позволит отправлять и получать сообщения.
