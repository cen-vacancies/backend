# Документация по работе с сокетами

## Подключение

Для подключения к сокету рекомендуется использовать библиотеку [phoenix](https://www.npmjs.com/package/phoenix). Пример использования библиотеки можно найти в файле [user_socket.js](assets/js/user_socket.js).

### URL для подключения

Подключение к сокету осуществляется по пути `/api/socket`.

### Аутентификация

При подключении необходимо указать текущий API токен.

### Формирование топика

Название топика формируется следующим образом:

```plaintext
chat:${cv_id}:${vacancy_id}
```

## Подготовка к подключению

Перед подключением к сокету необходимо создать чат с помощью API-запроса:

```plaintext
POST /api/chats/send_message
```

Без предварительного создания чата подключение будет неудачным.

## Ивенты

### Отправка сообщения

Сервер принимает ивенты только одного типа: `new_message`. Схема запроса аналогична API-запросу:

```plaintext
POST /api/chats/send_message
```

### Получение нового сообщения

При создании нового сообщения сервер отправляет ивент `new_message` клиенту. Схема ответа аналогична схеме ответа для API-запроса:

```plaintext
POST /api/chats/send_message
```
